---
import Layout from "@/layouts/Layout.astro";
import { getSession } from "auth-astro/server";
import type { Session } from "@auth/core/types";

// --------------- LOCAL UI STATE ----------------------

/** PDF files available to all users. */
const files = [
  {
    filename: "MuHSiC Interviewer Manual",
    link: "/material/0_Interviewer-manual.pdf",
  },
  {
    filename: "English Sociolinguistic Interview Questions",
    link: "/material/1_Sociolinguistic-interview-questions-English.pdf",
  },
  {
    filename: "Spanish Sociolinguistic Interview Questions",
    link: "/material/2_Sociolinguistic-interview-questions-Spanish.pdf",
  },
  {
    filename: "Interviewer Background Form",
    link: "/material/3_Interviewer-background.pdf",
  },
  {
    filename: "Interviewer Field Notes",
    link: "/material/4_Interviewer-field_notes.pdf",
  },
  {
    filename: "Cuestionario Sociodemogr√°fico",
    link: "/material/5_Cuestionario-sociodemogr%C3%A1fico.pdf",
  },
  {
    filename: "BLP (English-Spanish)",
    link: "/material/6a_BLP-ENGLISH-SPANISH.pdf",
  },
  {
    filename: "BLP (Spanish-English)",
    link: "/material/6b_BLP-ESPA%C3%91OL-INGL%C3%89S.pdf",
  },
];

// --------------- COMPUTED DATA -----------------------

/** Current user's session, null if not authenticated. */
const session: Session | null = await getSession(Astro.request);

/** The current user's role, name, and email. */
const user: { role?: string; name?: string; email?: string } | undefined = session?.user as { role?: string; name?: string; email?: string };

/** The role of the current user. */
const role: string = user?.role || "guest";
---

<Layout>
  { role === "researcher" ? 
    <h1>Download Links to Full Corpus</h1>
    <ul>
      <li>
        <a href="/bulk_wav.zip">
          wav files - full corpus audio
        </a>
      </li>
      <li>
        <a href="/bulk_pdf.zip">
          pdf files - full corpus transcripts
        </a>
      </li>
      <li>
        <a href="/bulk_docx.zip">
          docx files - full corpus transcripts
        </a>
      </li>
    </ul>
  : null }
  <h1>
    Interview Materials
  </h1>
  <ul>
    {
      files.map((file) => (
        <li>
          <a href={file.link}>
            {file.filename}
          </a>
        </li>
      ))
    }
  </ul>
</Layout>